<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Luna AI ‚ú®</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: rgba(255, 255, 255, 0.03);
            --bg-glass: rgba(255, 255, 255, 0.05);
            
            --accent-purple: #8b5cf6;
            --accent-pink: #ec4899;
            --accent-blue: #3b82f6;
            --accent-cyan: #06b6d4;
            --accent-gold: #f59e0b;
            
            --gradient-primary: linear-gradient(135deg, #8b5cf6 0%, #ec4899 50%, #f59e0b 100%);
            --gradient-card: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(236, 72, 153, 0.1) 100%);
            
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-muted: rgba(255, 255, 255, 0.4);
            
            --border-color: rgba(255, 255, 255, 0.08);
            --shadow-glow: 0 0 60px rgba(139, 92, 246, 0.3);
            
            --radius-sm: 12px;
            --radius-md: 16px;
            --radius-lg: 24px;
            --radius-xl: 32px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .bg-orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.5;
            animation: float 20s ease-in-out infinite;
        }

        .bg-orb-1 {
            width: 300px;
            height: 300px;
            background: var(--accent-purple);
            top: -100px;
            left: -100px;
        }

        .bg-orb-2 {
            width: 400px;
            height: 400px;
            background: var(--accent-pink);
            bottom: -150px;
            right: -150px;
            animation-delay: -5s;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(-20px, 20px) scale(0.9); }
        }

        .app-container {
            max-width: 100%;
            min-height: 100vh;
            padding: 16px;
            padding-bottom: 100px;
        }

        /* Header */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 0;
            margin-bottom: 24px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: var(--gradient-primary);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: var(--shadow-glow);
        }

        .logo-text {
            font-size: 24px;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--gradient-card);
            border: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
        }

        .premium-badge {
            background: var(--gradient-primary);
            padding: 4px 10px;
            border-radius: 50px;
            font-size: 11px;
            font-weight: 600;
        }

        /* –õ–∏–º–∏—Ç */
        .limit-banner {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(236, 72, 153, 0.2) 100%);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: var(--radius-lg);
            padding: 16px;
            margin-bottom: 20px;
            display: none;
        }

        .limit-banner.show {
            display: block;
        }

        .limit-title {
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .limit-text {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        /* –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ */
        .free-tries {
            background: var(--bg-glass);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 12px 16px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .tries-label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .tries-count {
            display: flex;
            gap: 6px;
        }

        .try-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--accent-gold);
        }

        .try-dot.used {
            background: var(--border-color);
        }

        /* Cards */
        .card {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
            position: relative;
        }

        .card.locked {
            opacity: 0.6;
        }

        .card.locked::after {
            content: 'üîí';
            position: absolute;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            font-size: 20px;
        }

        .card:active:not(.locked) {
            transform: scale(0.98);
        }

        /* Features Grid */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .feature-card {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .feature-card.locked {
            opacity: 0.5;
        }

        .feature-card.locked::before {
            content: 'üîí';
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 14px;
        }

        .feature-icon {
            width: 56px;
            height: 56px;
            margin: 0 auto 12px;
            background: var(--gradient-primary);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }

        .feature-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .feature-desc {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Daily Card */
        .daily-card {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(236, 72, 153, 0.2) 100%);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: var(--radius-xl);
            padding: 24px;
            margin-bottom: 24px;
            position: relative;
        }

        .daily-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--accent-purple);
            margin-bottom: 8px;
        }

        .daily-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .daily-text {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 16px;
        }

        /* Buttons */
        .btn {
            width: 100%;
            padding: 16px;
            border-radius: var(--radius-md);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-secondary {
            background: var(--bg-glass);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn:active:not(:disabled) {
            transform: scale(0.98);
        }

        /* Bottom Nav */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(10, 10, 15, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--border-color);
            padding: 12px 16px;
            padding-bottom: calc(12px + env(safe-area-inset-bottom));
            display: flex;
            justify-content: space-around;
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: var(--text-muted);
            font-size: 10px;
            cursor: pointer;
            padding: 8px 16px;
            border-radius: var(--radius-md);
        }

        .nav-item.active {
            color: var(--accent-purple);
        }

        .nav-icon {
            font-size: 24px;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: none;
            align-items: flex-end;
            justify-content: center;
            padding: 16px;
        }

        .modal-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal {
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            background: var(--bg-secondary);
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
            overflow: hidden;
            animation: slideUp 0.4s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--bg-glass);
            border: none;
            color: var(--text-primary);
            font-size: 18px;
            cursor: pointer;
        }

        .modal-content {
            padding: 24px;
            overflow-y: auto;
            max-height: calc(90vh - 80px);
        }

        /* Subscription Card */
        .sub-card {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(236, 72, 153, 0.2) 100%);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: var(--radius-xl);
            padding: 24px;
            text-align: center;
        }

        .sub-crown {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .sub-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .sub-features {
            text-align: left;
            margin: 16px 0;
        }

        .sub-feature {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .sub-feature::before {
            content: '‚úì';
            color: var(--accent-gold);
            font-weight: bold;
        }

        .sub-price {
            font-size: 32px;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .sub-period {
            color: var(--text-muted);
            font-size: 14px;
        }

        /* Tarot */
        .tarot-cards {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 24px 0;
            perspective: 1000px;
        }

        .tarot-card {
            width: 90px;
            height: 140px;
            background: linear-gradient(180deg, #1a1a2e 0%, #0f0f1a 100%);
            border: 2px solid var(--accent-purple);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            cursor: pointer;
            transition: all 0.5s ease;
        }

        .tarot-card::before {
            content: 'üé¥';
        }

        .tarot-card.revealed::before {
            content: attr(data-emoji);
        }

        .tarot-card.selected {
            border-color: var(--accent-gold);
            box-shadow: 0 0 30px rgba(245, 158, 11, 0.5);
            transform: translateY(-10px);
        }

        /* Result */
        .reading-result {
            background: var(--bg-glass);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-top: 20px;
        }

        .reading-card-name {
            font-size: 18px;
            font-weight: 600;
            color: var(--accent-purple);
            margin-bottom: 12px;
        }

        .reading-interpretation {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        /* Toast */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 14px;
            z-index: 2000;
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        /* Pages */
        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* Loader */
        .loader {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .loader-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top-color: var(--accent-purple);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Zodiac Badge */
        .zodiac-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--bg-glass);
            border: 1px solid var(--border-color);
            padding: 10px 20px;
            border-radius: 50px;
            margin-top: 16px;
            font-size: 14px;
        }

        /* Profile */
        .profile-header {
            text-align: center;
            padding: 24px 0;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            margin: 0 auto 16px;
        }

        .profile-name {
            font-size: 24px;
            font-weight: 700;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 24px;
        }

        .stat-card {
            background: var(--bg-glass);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 16px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="bg-animation">
        <div class="bg-orb bg-orb-1"></div>
        <div class="bg-orb bg-orb-2"></div>
    </div>

    <div class="toast" id="toast">
        <span id="toastIcon">‚ú®</span>
        <span id="toastText">–°–æ–æ–±—â–µ–Ω–∏–µ</span>
    </div>

    <div class="app-container">
        <!-- –ì–õ–ê–í–ù–ê–Ø -->
        <div class="page active" id="page-home">
            <header class="header">
                <div class="logo">
                    <div class="logo-icon">üîÆ</div>
                    <span class="logo-text">Astro AI</span>
                </div>
                <div class="user-info">
                    <span class="premium-badge" id="premiumBadge" style="display: none;">üëë PRO</span>
                    <div class="user-avatar" onclick="showPage('profile')" id="userAvatar">üë§</div>
                </div>
            </header>

            <!-- –õ–∏–º–∏—Ç -->
            <div class="limit-banner" id="limitBanner">
                <div class="limit-title">‚ö†Ô∏è –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ª–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω</div>
                <div class="limit-text">–û—Ñ–æ—Ä–º–∏ –ø–æ–¥–ø–∏—Å–∫—É –¥–ª—è –±–µ–∑–ª–∏–º–∏—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º</div>
                <button class="btn btn-primary" onclick="openSubscriptionModal()">
                    üëë –û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
                </button>
            </div>

            <!-- –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ -->
            <div class="free-tries" id="freeTries">
                <span class="tries-label">üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏:</span>
                <div class="tries-count" id="triesCount">
                    <div class="try-dot" id="try1"></div>
                </div>
            </div>

            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –¥–Ω—è -->
            <div class="daily-card" onclick="tryFeature('tarot')">
                <div class="daily-label">–ö–∞—Ä—Ç–∞ –¥–Ω—è</div>
                <div class="daily-title">–£–∑–Ω–∞–π —Å–≤–æ—ë –ø–æ—Å–ª–∞–Ω–∏–µ ‚ú®</div>
                <div class="daily-text">–í—ã—Ç—è–Ω–∏ –∫–∞—Ä—Ç—É –∏ –ø–æ–ª—É—á–∏ —Å–æ–≤–µ—Ç –æ—Ç –í—Å–µ–ª–µ–Ω–Ω–æ–π</div>
                <button class="btn btn-primary" style="width: auto; padding: 12px 24px;">
                    üé¥ –í—ã—Ç—è–Ω—É—Ç—å –∫–∞—Ä—Ç—É
                </button>
            </div>

            <!-- –§—É–Ω–∫—Ü–∏–∏ -->
            <div class="features-grid">
                <div class="feature-card" id="feature-tarot" onclick="tryFeature('tarot')">
                    <div class="feature-icon">üé¥</div>
                    <div class="feature-title">–¢–∞—Ä–æ</div>
                    <div class="feature-desc">–†–∞—Å–∫–ª–∞–¥—ã</div>
                </div>
                <div class="feature-card" id="feature-horoscope" onclick="tryFeature('horoscope')">
                    <div class="feature-icon">‚≠ê</div>
                    <div class="feature-title">–ì–æ—Ä–æ—Å–∫–æ–ø</div>
                    <div class="feature-desc">–ù–∞ —Å–µ–≥–æ–¥–Ω—è</div>
                </div>
                <div class="feature-card locked" id="feature-compat" onclick="tryFeature('compatibility')">
                    <div class="feature-icon">üíï</div>
                    <div class="feature-title">–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å</div>
                    <div class="feature-desc">PRO</div>
                </div>
                <div class="feature-card locked" id="feature-money" onclick="tryFeature('money')">
                    <div class="feature-icon">üí∞</div>
                    <div class="feature-title">–î–µ–Ω—å–≥–∏</div>
                    <div class="feature-desc">PRO</div>
                </div>
            </div>

            <!-- PRO —Ñ—É–Ω–∫—Ü–∏–∏ -->
            <div class="card" onclick="openSubscriptionModal()">
                <div style="display: flex; align-items: center; gap: 16px;">
                    <span style="font-size: 40px;">üëë</span>
                    <div>
                        <div style="font-weight: 600;">–†–∞–∑–±–ª–æ–∫–∏—Ä—É–π –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏</div>
                        <div style="color: var(--text-muted); font-size: 13px;">–ë–µ–∑–ª–∏–º–∏—Ç ‚Ä¢ –í—Å–µ —Ä–∞—Å–∫–ª–∞–¥—ã ‚Ä¢ –ü—Ä–æ–≥–Ω–æ–∑—ã</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –¢–ê–†–û -->
        <div class="page" id="page-tarot">
            <header class="header">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <button onclick="showPage('home')" style="background: none; border: none; color: white; font-size: 20px;">‚Üê</button>
                    <span style="font-size: 18px; font-weight: 600;">üé¥ –†–∞—Å–∫–ª–∞–¥ –¢–∞—Ä–æ</span>
                </div>
            </header>

            <div style="text-align: center; padding: 20px 0;">
                <p style="color: var(--text-secondary);">–í—ã–±–µ—Ä–∏ –∫–∞—Ä—Ç—É –∏ —É–∑–Ω–∞–π –ø–æ—Å–ª–∞–Ω–∏–µ</p>
            </div>

            <div class="tarot-cards" id="tarotCards">
                <div class="tarot-card" onclick="selectCard(0)"></div>
                <div class="tarot-card" onclick="selectCard(1)"></div>
                <div class="tarot-card" onclick="selectCard(2)"></div>
            </div>

            <div id="tarotResult" style="display: none;">
                <div class="reading-result">
                    <div class="reading-card-name" id="cardName">üé¥ –ú–∞–≥</div>
                    <div class="reading-interpretation" id="cardText">
                        –ö–∞—Ä—Ç–∞ —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä—É–µ—Ç —Å–∏–ª—É –≤–æ–ª–∏ –∏ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ...
                    </div>
                </div>
            </div>

            <button class="btn btn-primary" id="tarotBtn" onclick="doReading()" style="margin-top: 20px;">
                üîÆ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å–∫–ª–∞–¥
            </button>
        </div>

        <!-- –ì–û–†–û–°–ö–û–ü -->
        <div class="page" id="page-horoscope">
            <header class="header">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <button onclick="showPage('home')" style="background: none; border: none; color: white; font-size: 20px;">‚Üê</button>
                    <span style="font-size: 18px; font-weight: 600;">‚≠ê –ì–æ—Ä–æ—Å–∫–æ–ø</span>
                </div>
            </header>

            <div style="text-align: center; padding: 20px 0;">
                <div style="font-size: 64px;" id="horoEmoji">‚ôà</div>
                <div style="font-size: 24px; font-weight: 700;" id="horoName">–û–≤–µ–Ω</div>
            </div>

            <div class="card" id="horoscopeContent">
                <div class="loader">
                    <div class="loader-spinner"></div>
                </div>
            </div>
        </div>

        <!-- –ü–†–û–§–ò–õ–¨ -->
        <div class="page" id="page-profile">
            <header class="header">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <button onclick="showPage('home')" style="background: none; border: none; color: white; font-size: 20px;">‚Üê</button>
                    <span style="font-size: 18px; font-weight: 600;">üë§ –ü—Ä–æ—Ñ–∏–ª—å</span>
                </div>
            </header>

            <div class="profile-header">
                <div class="profile-avatar" id="profileAvatar">üë§</div>
                <div class="profile-name" id="profileName">–ü—É—Ç–Ω–∏–∫</div>
                <div class="zodiac-badge" id="profileZodiac">
                    <span>‚ôà</span>
                    <span>–û–≤–µ–Ω</span>
                </div>
            </div>

            <div class="profile-stats">
                <div class="stat-card">
                    <div class="stat-value" id="statReadings">0</div>
                    <div class="stat-label">–†–∞—Å–∫–ª–∞–¥–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statFree">1</div>
                    <div class="stat-label">–û—Å—Ç–∞–ª–æ—Å—å</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statDays">0</div>
                    <div class="stat-label">–ë–æ–Ω—É—Å</div>
                </div>
            </div>

            <div class="card" style="margin-top: 24px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div style="font-weight: 600;">‚≠ê –ü–æ–¥–ø–∏—Å–∫–∞</div>
                        <div style="color: var(--text-muted); font-size: 13px;" id="subStatus">–ù–µ –∞–∫—Ç–∏–≤–Ω–∞</div>
                    </div>
                    <button class="btn btn-primary" style="width: auto; padding: 10px 20px;" onclick="openSubscriptionModal()">
                        –û—Ñ–æ—Ä–º–∏—Ç—å
                    </button>
                </div>
            </div>

            <div class="card">
                <div style="font-weight: 600; margin-bottom: 12px;">üë• –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞</div>
                <div style="color: var(--text-secondary); font-size: 13px; margin-bottom: 12px;">
                    –ü–æ–ª—É—á–∏ +1 –¥–µ–Ω—å –ø–æ–¥–ø–∏—Å–∫–∏ –∑–∞ –∫–∞–∂–¥–æ–≥–æ –¥—Ä—É–≥–∞!
                </div>
                <button class="btn btn-secondary" onclick="shareReferral()">
                    üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π
                </button>
            </div>
        </div>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="bottom-nav">
        <div class="nav-item active" onclick="showPage('home')" id="nav-home">
            <span class="nav-icon">üè†</span>
            <span>–ì–ª–∞–≤–Ω–∞—è</span>
        </div>
        <div class="nav-item" onclick="tryFeature('tarot')" id="nav-tarot">
            <span class="nav-icon">üé¥</span>
            <span>–¢–∞—Ä–æ</span>
        </div>
        <div class="nav-item" onclick="tryFeature('horoscope')" id="nav-horoscope">
            <span class="nav-icon">‚≠ê</span>
            <span>–ì–æ—Ä–æ—Å–∫–æ–ø</span>
        </div>
        <div class="nav-item" onclick="showPage('profile')" id="nav-profile">
            <span class="nav-icon">üë§</span>
            <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </div>
    </nav>

    <!-- –ú–û–î–ê–õ–ö–ê –ü–û–î–ü–ò–°–ö–ò -->
    <div class="modal-overlay" id="subscriptionModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">üëë –ü—Ä–µ–º–∏—É–º –ø–æ–¥–ø–∏—Å–∫–∞</span>
                <button class="modal-close" onclick="closeSubscriptionModal()">‚úï</button>
            </div>
            <div class="modal-content">
                <div class="sub-card">
                    <div class="sub-crown">üëë</div>
                    <div class="sub-title">Astro AI Premium</div>
                    
                    <div class="sub-features">
                        <div class="sub-feature">–ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ —Ä–∞—Å–∫–ª–∞–¥—ã –¢–∞—Ä–æ</div>
                        <div class="sub-feature">–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –≥–æ—Ä–æ—Å–∫–æ–ø</div>
                        <div class="sub-feature">–ê–Ω–∞–ª–∏–∑ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏</div>
                        <div class="sub-feature">–î–µ–Ω–µ–∂–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑</div>
                        <div class="sub-feature">–ö–∞—Ä–º–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–±–æ—Ä</div>
                        <div class="sub-feature">–õ—É–Ω–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å</div>
                        <div class="sub-feature">–ë–µ–∑ —Ä–µ–∫–ª–∞–º—ã</div>
                    </div>
                    
                    <div class="sub-price">490 ‚ÇΩ</div>
                    <div class="sub-period">–≤ –º–µ—Å—è—Ü</div>
                </div>

                <button class="btn btn-primary" style="margin-top: 20px;" onclick="buySubscription('stars')">
                    ‚≠ê –û–ø–ª–∞—Ç–∏—Ç—å 250 Stars
                </button>
                
                <button class="btn btn-secondary" style="margin-top: 12px;" onclick="buySubscription('card')">
                    üí≥ –û–ø–ª–∞—Ç–∏—Ç—å –∫–∞—Ä—Ç–æ–π 490 ‚ÇΩ
                </button>

                <p style="text-align: center; color: var(--text-muted); font-size: 12px; margin-top: 16px;">
                    –ü–æ–¥–ø–∏—Å–∫–∞ –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.<br>
                    –û—Ç–º–µ–Ω–∏—Ç—å –º–æ–∂–Ω–æ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç.
                </p>
            </div>
        </div>
    </div>

    <script>
        // ==================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ====================
        
        const CONFIG = {
            API_URL: window.location.origin + '/api',
            FREE_LIMIT: 1,
            STARS_PRICE: 250,
            RUB_PRICE: 490
        };

        // ==================== –°–û–°–¢–û–Ø–ù–ò–ï ====================
        
        let state = {
            userId: null,
            userName: '–ü—É—Ç–Ω–∏–∫',
            zodiac: null,
            zodiacEmoji: '‚ôà',
            isPremium: false,
            freeUsed: 0,
            readings: 0,
            bonusDays: 0
        };

        const tg = window.Telegram?.WebApp;

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        
        document.addEventListener('DOMContentLoaded', initApp);

        async function initApp() {
            if (tg) {
                tg.ready();
                tg.expand();
                tg.setHeaderColor('#0a0a0f');
                tg.setBackgroundColor('#0a0a0f');
                
                if (tg.initDataUnsafe?.user) {
                    const user = tg.initDataUnsafe.user;
                    state.userId = user.id;
                    state.userName = user.first_name || '–ü—É—Ç–Ω–∏–∫';
                }
            }
            
            await loadUserData();
            updateUI();
        }

        async function loadUserData() {
            if (!state.userId) return;
            
            try {
                const response = await fetch(`${CONFIG.API_URL}/user/${state.userId}`, {
                    headers: { 'X-Telegram-Init-Data': tg?.initData || '' }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    state = { ...state, ...data };
                }
            } catch (e) {
                console.log('Offline mode');
            }
        }

        // ==================== UI ====================
        
        function updateUI() {
            // –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            document.getElementById('profileName').textContent = state.userName;
            document.getElementById('userAvatar').textContent = getEmoji(state.userName);
            document.getElementById('profileAvatar').textContent = getEmoji(state.userName);
            
            // –ü—Ä–µ–º–∏—É–º —Å—Ç–∞—Ç—É—Å
            if (state.isPremium) {
                document.getElementById('premiumBadge').style.display = 'inline-block';
                document.getElementById('freeTries').style.display = 'none';
                document.getElementById('limitBanner').classList.remove('show');
                document.getElementById('subStatus').textContent = '–ê–∫—Ç–∏–≤–Ω–∞ ‚úì';
                document.getElementById('subStatus').style.color = '#10b981';
                
                // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏
                document.querySelectorAll('.feature-card.locked').forEach(el => {
                    el.classList.remove('locked');
                });
            } else {
                document.getElementById('premiumBadge').style.display = 'none';
                document.getElementById('freeTries').style.display = 'flex';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á—ë—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫
                const freeLeft = CONFIG.FREE_LIMIT - state.freeUsed;
                document.getElementById('statFree').textContent = Math.max(0, freeLeft);
                
                if (state.freeUsed > 0) {
                    document.getElementById('try1').classList.add('used');
                }
                
                if (freeLeft <= 0) {
                    document.getElementById('limitBanner').classList.add('show');
                }
            }
            
            // –ó–æ–¥–∏–∞–∫
            if (state.zodiac) {
                document.getElementById('profileZodiac').innerHTML = `
                    <span>${state.zodiacEmoji}</span>
                    <span>${state.zodiac}</span>
                `;
                document.getElementById('horoEmoji').textContent = state.zodiacEmoji;
                document.getElementById('horoName').textContent = state.zodiac;
            }
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            document.getElementById('statReadings').textContent = state.readings;
            document.getElementById('statDays').textContent = state.bonusDays;
        }

        function getEmoji(name) {
            const emojis = ['üåü', '‚ú®', 'üí´', '‚≠ê', 'üîÆ', 'üåô'];
            return emojis[name.charCodeAt(0) % emojis.length];
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            document.getElementById('toastIcon').textContent = type === 'success' ? '‚ú®' : '‚ö†Ô∏è';
            document.getElementById('toastText').textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // ==================== –ù–ê–í–ò–ì–ê–¶–ò–Ø ====================
        
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(`page-${pageId}`).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            const navItem = document.getElementById(`nav-${pageId}`);
            if (navItem) navItem.classList.add('active');
            
            if (tg?.HapticFeedback) {
                tg.HapticFeedback.selectionChanged();
            }
        }

        // ==================== –ü–†–û–í–ï–†–ö–ê –õ–ò–ú–ò–¢–ê ====================
        
        function tryFeature(feature) {
            // –ü—Ä–µ–º–∏—É–º ‚Äî –≤—Å—ë –¥–æ—Å—Ç—É–ø–Ω–æ
            if (state.isPremium) {
                openFeature(feature);
                return;
            }
            
            // –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—Å–µ–≥–¥–∞ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞
            const proFeatures = ['compatibility', 'money', 'karma'];
            
            if (proFeatures.includes(feature)) {
                showToast('–î–æ—Å—Ç—É–ø–Ω–æ —Å –ø–æ–¥–ø–∏—Å–∫–æ–π', 'error');
                openSubscriptionModal();
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç
            if (state.freeUsed >= CONFIG.FREE_LIMIT) {
                showToast('–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ª–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω', 'error');
                openSubscriptionModal();
                return;
            }
            
            openFeature(feature);
        }

        function openFeature(feature) {
            if (feature === 'tarot') {
                showPage('tarot');
                resetTarot();
            } else if (feature === 'horoscope') {
                showPage('horoscope');
                loadHoroscope();
            } else if (feature === 'compatibility') {
                showPage('compatibility');
            } else if (feature === 'money') {
                showPage('money');
            }
        }

        // ==================== –¢–ê–†–û ====================
        
        let selectedCardIndex = -1;
        const CARDS = [
            { name: '–®—É—Ç', emoji: 'üÉè', text: '–ù–æ–≤—ã–µ –Ω–∞—á–∏–Ω–∞–Ω–∏—è –∏ —Å–≤–æ–±–æ–¥–∞ –¥—É—Ö–∞. –í—Ä–µ–º—è –¥–æ–≤–µ—Ä–∏—Ç—å—Å—è –ø–æ—Ç–æ–∫—É –∂–∏–∑–Ω–∏!' },
            { name: '–ú–∞–≥', emoji: 'üé©', text: '–°–∏–ª–∞ –≤–æ–ª–∏ –∏ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ. –í—Å–µ —Ä–µ—Å—É—Ä—Å—ã –¥–ª—è —É—Å–ø–µ—Ö–∞ —É —Ç–µ–±—è –µ—Å—Ç—å.' },
            { name: '–í–µ—Ä—Ö–æ–≤–Ω–∞—è –ñ—Ä–∏—Ü–∞', emoji: 'üåô', text: '–ò–Ω—Ç—É–∏—Ü–∏—è –∏ —Ç–∞–π–Ω—ã–µ –∑–Ω–∞–Ω–∏—è. –ü—Ä–∏—Å–ª—É—à–∞–π—Å—è –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É –≥–æ–ª–æ—Å—É.' },
            { name: '–ò–º–ø–µ—Ä–∞—Ç—Ä–∏—Ü–∞', emoji: 'üëë', text: '–ò–∑–æ–±–∏–ª–∏–µ –∏ –ø–ª–æ–¥–æ—Ä–æ–¥–∏–µ. –í—Ä–µ–º—è –¥–ª—è —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞ –∏ –∑–∞–±–æ—Ç—ã.' },
            { name: '–ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã', emoji: 'üé°', text: '–ü–µ—Ä–µ–º–µ–Ω—ã –∏ —É–¥–∞—á–∞. –°—É–¥—å–±–∞ –±–ª–∞–≥–æ–≤–æ–ª–∏—Ç —Ç–µ–±–µ!' },
            { name: '–ó–≤–µ–∑–¥–∞', emoji: '‚≠ê', text: '–ù–∞–¥–µ–∂–¥–∞ –∏ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ. –°–≤–µ—Ç–ª–æ–µ –±—É–¥—É—â–µ–µ –≤–ø–µ—Ä–µ–¥–∏.' },
            { name: '–°–æ–ª–Ω—Ü–µ', emoji: '‚òÄÔ∏è', text: '–†–∞–¥–æ—Å—Ç—å –∏ —É—Å–ø–µ—Ö! –í—Å—ë —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –Ω–∞–∏–ª—É—á—à–∏–º –æ–±—Ä–∞–∑–æ–º.' },
            { name: '–ú–∏—Ä', emoji: 'üåç', text: '–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ü–∏–∫–ª–∞ –∏ –≥–∞—Ä–º–æ–Ω–∏—è. –¢—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø—É—Ç–∏.' }
        ];

        function resetTarot() {
            selectedCardIndex = -1;
            document.querySelectorAll('.tarot-card').forEach(c => {
                c.classList.remove('selected', 'revealed');
                c.removeAttribute('data-emoji');
            });
            document.getElementById('tarotResult').style.display = 'none';
            document.getElementById('tarotBtn').style.display = 'block';
        }

        function selectCard(index) {
            document.querySelectorAll('.tarot-card').forEach(c => c.classList.remove('selected'));
            document.querySelectorAll('.tarot-card')[index].classList.add('selected');
            selectedCardIndex = index;
            
            if (tg?.HapticFeedback) {
                tg.HapticFeedback.selectionChanged();
            }
        }

        async function doReading() {
            if (selectedCardIndex < 0) {
                showToast('–í—ã–±–µ—Ä–∏ –∫–∞—Ä—Ç—É', 'error');
                return;
            }
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ø—ã—Ç–∫—É
            if (!state.isPremium) {
                state.freeUsed++;
                state.readings++;
                updateUI();
                
                // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º
                await syncAction('use_reading', {});
            }
            
            // –ê–Ω–∏–º–∞—Ü–∏—è
            const card = document.querySelectorAll('.tarot-card')[selectedCardIndex];
            const randomCard = CARDS[Math.floor(Math.random() * CARDS.length)];
            
            card.classList.add('revealed');
            card.setAttribute('data-emoji', randomCard.emoji);
            
            if (tg?.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('heavy');
            }
            
            setTimeout(() => {
                document.getElementById('cardName').textContent = `${randomCard.emoji} ${randomCard.name}`;
                document.getElementById('cardText').textContent = randomCard.text;
                document.getElementById('tarotResult').style.display = 'block';
                document.getElementById('tarotBtn').style.display = 'none';
            }, 500);
        }

        // ==================== –ì–û–†–û–°–ö–û–ü ====================
        
        async function loadHoroscope() {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ø—ã—Ç–∫—É –µ—Å–ª–∏ –Ω–µ –ø—Ä–µ–º–∏—É–º
            if (!state.isPremium) {
                state.freeUsed++;
                updateUI();
                await syncAction('use_reading', {});
            }
            
            document.getElementById('horoscopeContent').innerHTML = `
                <div class="loader"><div class="loader-spinner"></div></div>
            `;
            
            setTimeout(() => {
                const texts = [
                    '–°–µ–≥–æ–¥–Ω—è –∑–≤—ë–∑–¥—ã –±–ª–∞–≥–æ–≤–æ–ª—è—Ç –Ω–æ–≤—ã–º –Ω–∞—á–∏–Ω–∞–Ω–∏—è–º. –û—Ç–ª–∏—á–Ω—ã–π –¥–µ–Ω—å –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –∏ –≤–∞–∂–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π!',
                    '–î–µ–Ω—å –ø—Ä–∏–Ω–µ—Å—ë—Ç –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏. –ë—É–¥—å –æ—Ç–∫—Ä—ã—Ç –ø–µ—Ä–µ–º–µ–Ω–∞–º ‚Äî –æ–Ω–∏ –∫ –ª—É—á—à–µ–º—É.',
                    '–≠–Ω–µ—Ä–≥–∏—è –¥–Ω—è —Å–ø–æ—Å–æ–±—Å—Ç–≤—É–µ—Ç —Ç–≤–æ—Ä—á–µ—Å—Ç–≤—É –∏ –æ–±—â–µ–Ω–∏—é. –ù–µ —É–ø—É—Å–∫–∞–π —à–∞–Ω—Å –ø—Ä–æ—è–≤–∏—Ç—å —Å–µ–±—è!',
                    '–ó–≤—ë–∑–¥—ã —Å–æ–≤–µ—Ç—É—é—Ç —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω–æ–º. –û—Ç–±—Ä–æ—Å—å —Å–æ–º–Ω–µ–Ω–∏—è –∏ –¥–µ–π—Å—Ç–≤—É–π!'
                ];
                
                document.getElementById('horoscopeContent').innerHTML = `
                    <div style="font-weight: 600; margin-bottom: 12px; color: var(--accent-purple);">üåü –ì–æ—Ä–æ—Å–∫–æ–ø –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</div>
                    <div style="color: var(--text-secondary); line-height: 1.8;">
                        ${texts[Math.floor(Math.random() * texts.length)]}
                    </div>
                `;
            }, 1500);
        }

        // ==================== –ü–û–î–ü–ò–°–ö–ê ====================
        
        function openSubscriptionModal() {
            document.getElementById('subscriptionModal').classList.add('active');
            if (tg?.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('medium');
            }
        }

        function closeSubscriptionModal() {
            document.getElementById('subscriptionModal').classList.remove('active');
        }

        async function buySubscription(method) {
            if (method === 'stars' && tg) {
                // Telegram Stars ‚Äî —á–µ—Ä–µ–∑ –±–æ—Ç–∞
                try {
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–≤–æ–π—Å–∞
                    const response = await fetch(`${CONFIG.API_URL}/create-invoice`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Telegram-Init-Data': tg?.initData || ''
                        },
                        body: JSON.stringify({
                            user_id: state.userId,
                            product: 'subscription',
                            method: 'stars'
                        })
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        
                        if (data.invoice_link) {
                            // –û—Ç–∫—Ä—ã–≤–∞–µ–º –∏–Ω–≤–æ–π—Å
                            tg.openInvoice(data.invoice_link, (status) => {
                                if (status === 'paid') {
                                    state.isPremium = true;
                                    updateUI();
                                    closeSubscriptionModal();
                                    showToast('–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞! üéâ');
                                } else if (status === 'cancelled') {
                                    showToast('–û–ø–ª–∞—Ç–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞', 'error');
                                }
                            });
                        } else {
                            // Fallback ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –±–æ—Ç
                            tg.sendData(JSON.stringify({
                                action: 'buy_subscription',
                                method: 'stars'
                            }));
                            tg.close();
                        }
                    }
                } catch (e) {
                    // Fallback ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –±–æ—Ç
                    tg.sendData(JSON.stringify({
                        action: 'buy_subscription',
                        method: 'stars'
                    }));
                    tg.close();
                }
            } else if (method === 'card') {
                // –ÆKassa ‚Äî —á–µ—Ä–µ–∑ –±–æ—Ç
                if (tg) {
                    tg.sendData(JSON.stringify({
                        action: 'buy_subscription',
                        method: 'yookassa'
                    }));
                    showToast('–ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –æ–ø–ª–∞—Ç–µ...');
                    setTimeout(() => tg.close(), 1000);
                } else {
                    showToast('–û—Ç–∫—Ä–æ–π –≤ Telegram', 'error');
                }
            }
        }

        // ==================== –†–ï–§–ï–†–ê–õ ====================
        
        function shareReferral() {
            const botUsername = 'AstroAI_bot'; // –ó–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π
            const link = `https://t.me/${botUsername}?start=ref_${state.userId}`;
            const text = `üîÆ –û—Ç–∫—Ä–æ–π –¥–ª—è —Å–µ–±—è –º–∏—Ä –¢–∞—Ä–æ –∏ –∞—Å—Ç—Ä–æ–ª–æ–≥–∏–∏!\n\n${link}`;
            
            if (tg) {
                tg.switchInlineQuery(text, ['users']);
            } else {
                navigator.clipboard?.writeText(link);
                showToast('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
            }
        }

        // ==================== API ====================
        
        async function syncAction(action, data) {
            try {
                await fetch(`${CONFIG.API_URL}/action`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Telegram-Init-Data': tg?.initData || ''
                    },
                    body: JSON.stringify({
                        user_id: state.userId,
                        action: action,
                        data: data
                    })
                });
            } catch (e) {
                console.log('Sync failed');
            }
        }
    </script>
</body>
</html>
